"use strict";(self.webpackChunkpublic_docs=self.webpackChunkpublic_docs||[]).push([[768],{9026:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"product-documentation/operational-metrics","title":"Operational Metrics","description":"Observe how Divvi Up is working.","source":"@site/docs/product-documentation/operational-metrics.md","sourceDirName":"product-documentation","slug":"/product-documentation/operational-metrics","permalink":"/product-documentation/operational-metrics","draft":false,"unlisted":false,"editUrl":"https://github.com/divviup/public-docs/tree/main/docs/product-documentation/operational-metrics.md","tags":[],"version":"current","frontMatter":{"toc_max_heading_level":4},"sidebar":"docSidebar","previous":{"title":"Emulating Categorical Histograms with DAP draft-04","permalink":"/product-documentation/categorical-histogram-dap-04"},"next":{"title":"References","permalink":"/references/"}}');var n=t(4848),o=t(8453);const s={toc_max_heading_level:4},a="Operational Metrics",l={},c=[{value:"Upload Metrics",id:"upload-metrics",level:2},{value:"Successful Uploads",id:"successful-uploads",level:3},{value:"Upload Errors",id:"upload-errors",level:3},{value:"Interval Collected Failure",id:"interval-collected-failure",level:4},{value:"Decode Failure",id:"decode-failure",level:4},{value:"Decrypt Failure",id:"decrypt-failure",level:4},{value:"Report Expired Failure",id:"report-expired-failure",level:4},{value:"Outdated Key Failure",id:"outdated-key-failure",level:4},{value:"Report Too Early Failure",id:"report-too-early-failure",level:4},{value:"Task Expired Failure",id:"task-expired-failure",level:4},{value:"Aggregation Job Metrics",id:"aggregation-job-metrics",level:2},{value:"Successful Report Preparations",id:"successful-report-preparations",level:3},{value:"Aggregation Errors",id:"aggregation-errors",level:3},{value:"Batch Collected (Helper) Failure",id:"batch-collected-helper-failure",level:4},{value:"Report Replayed (Helper) Failure",id:"report-replayed-helper-failure",level:4},{value:"Report Dropped (Helper) Failure",id:"report-dropped-helper-failure",level:4},{value:"Unknown HPKE Config ID (Helper) Failure",id:"unknown-hpke-config-id-helper-failure",level:4},{value:"HPKE Decryption (Helper) Failure",id:"hpke-decryption-helper-failure",level:4},{value:"VDAF Preparation (Helper) Failure",id:"vdaf-preparation-helper-failure",level:4},{value:"Task Expiration (Helper) Failure",id:"task-expiration-helper-failure",level:4},{value:"Invalid Message (Helper) Failure",id:"invalid-message-helper-failure",level:4},{value:"Report Too Early (Helper) Failure",id:"report-too-early-helper-failure",level:4},{value:"API Access",id:"api-access",level:2}];function h(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"operational-metrics",children:"Operational Metrics"})}),"\n",(0,n.jsx)(r.p,{children:"Observe how Divvi Up is working."}),"\n",(0,n.jsx)(r.h2,{id:"upload-metrics",children:"Upload Metrics"}),"\n",(0,n.jsx)(r.p,{children:"Tasks provide metrics on reports uploaded to them. Upload metrics are reported\nto Divvi Up via the task's leader aggregator, and represent the leader's ability\nto process the reports."}),"\n",(0,n.jsx)(r.p,{children:"Metrics are monotonic counters that last the lifetime of the task."}),"\n",(0,n.jsx)(r.admonition,{type:"note",children:(0,n.jsx)(r.p,{children:"This feature was implemented February 24th, 2024. Tasks created before will\nstart counting after then, rather than for the lifetime of the task."})}),"\n",(0,n.jsx)(r.h3,{id:"successful-uploads",children:"Successful Uploads"}),"\n",(0,n.jsx)(r.p,{children:"Indicates reports successfully ingested by the leader. Reports contributing to\nthis count are eligible for aggregation and collection. Use the rate of this\ncounter to inform how many reports this task gets over time."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"report_counter_success"})," in the Divvi Up API."]}),"\n",(0,n.jsx)(r.h3,{id:"upload-errors",children:"Upload Errors"}),"\n",(0,n.jsx)(r.p,{children:"Aggregators count some DAP-level errors that lead to report rejection. Rejected\nreports are not processed any further."}),"\n",(0,n.jsx)(r.p,{children:"See sections below for a description and basic troubleshooting steps for each\nerror type."}),"\n",(0,n.jsx)(r.h4,{id:"interval-collected-failure",children:"Interval Collected Failure"}),"\n",(0,n.jsx)(r.p,{children:"Indicates there were reports that had timestamps corresponding to time intervals\nthat were already collected. This is only applicable for tasks with a query type\nof time interval."}),"\n",(0,n.jsx)(r.p,{children:"The rate of this error depends on the accuracy of the client time source, and\nhow long the collector waits after a time interval has passed before collecting\nit. Use the rate to inform how long you should wait before collecting a time\ninterval."}),"\n",(0,n.jsx)(r.p,{children:"Depending on how the client derives the report timestamp, it may not be possible\nto fully eliminate this error."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"report_counter_interval_collected"})," in the Divvi Up API."]}),"\n",(0,n.jsx)(r.h4,{id:"decode-failure",children:"Decode Failure"}),"\n",(0,n.jsx)(r.p,{children:"Indicates there were reports that failed to decode from their DAP message\nrepresentation."}),"\n",(0,n.jsx)(r.p,{children:"This is most often caused by task configuration mismatch between the server and\nclient. Ensure that all client-side task parameters match those reported by\nDivvi Up. In particular, check for these common configuration mistakes:"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Client's DAP library is using an incorrect DAP version, e.g. library supports\nDAP-04 when the task supports DAP-07."}),"\n",(0,n.jsxs)(r.li,{children:["Using the wrong function, e.g. using ",(0,n.jsx)(r.code,{children:"sum"})," when the task is configured for\n",(0,n.jsx)(r.code,{children:"count"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"report_counter_decode_failure"})," in the Divvi Up API."]}),"\n",(0,n.jsx)(r.h4,{id:"decrypt-failure",children:"Decrypt Failure"}),"\n",(0,n.jsx)(r.p,{children:"Indicates there were reports whose leader share could not be decrypted."}),"\n",(0,n.jsx)(r.p,{children:"This is most often caused by clients using the incorrect HPKE configuration.\nEnsure that the client is using the correct task HPKE key and HPKE keys are not\nbeing permanently cached."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"report_counter_decrypt_failure"})," in the Divvi Up API."]}),"\n",(0,n.jsx)(r.h4,{id:"report-expired-failure",children:"Report Expired Failure"}),"\n",(0,n.jsx)(r.p,{children:"Indicates that there were reports whose timestamp was too old. Divvi Up rejects\nreports whose timestamps are more than 2 weeks in the past."}),"\n",(0,n.jsx)(r.p,{children:"Depending on how the client derives the report timestamp, it may not be possible\nto fully eliminate this error."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"report_counter_expired"})," in the Divvi Up API."]}),"\n",(0,n.jsx)(r.h4,{id:"outdated-key-failure",children:"Outdated Key Failure"}),"\n",(0,n.jsx)(r.p,{children:"Indicates that there were reports whose leader share was encrypted with an\nunknown or outdated HPKE key."}),"\n",(0,n.jsx)(r.p,{children:"Ensure that the client is using the correct task HPKE key and HPKE keys are not\nbeing permanently cached."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"report_counter_outdated_key"})," in the Divvi Up API."]}),"\n",(0,n.jsx)(r.h4,{id:"report-too-early-failure",children:"Report Too Early Failure"}),"\n",(0,n.jsx)(r.p,{children:"Indicates that there were reports whose timestamp was too far in the future.\nDivvi Up rejects reports whose timestamps are more than 60 seconds in the\nfuture."}),"\n",(0,n.jsx)(r.p,{children:"Depending on how the client derives the report timestamp, it may not be possible\nto fully eliminate this error."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"report_counter_too_early"})," in the Divvi Up API."]}),"\n",(0,n.jsx)(r.h4,{id:"task-expired-failure",children:"Task Expired Failure"}),"\n",(0,n.jsx)(r.p,{children:"Indicates there were reports sent to this task after it had expired."}),"\n",(0,n.jsx)(r.p,{children:"Use this metric to monitor clients migrating off of the expired task."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"report_counter_task_expired"})," in the Divvi Up API."]}),"\n",(0,n.jsx)(r.h2,{id:"aggregation-job-metrics",children:"Aggregation Job Metrics"}),"\n",(0,n.jsx)(r.p,{children:"Divvi Up records metrics on reports being prepared for aggregation in each task.\nThese work much the same way as upload metrics: they are reported via the task\nleader and are monotonic counters lasting the lifetime of a task."}),"\n",(0,n.jsxs)(r.p,{children:["These metrics record failures that can occur even if a report is successfully\nuploaded to the leader. In particular, errors in the task's helper are relayed\nto Divvi Up via this mechanism. This works for any helper conforming to the\n",(0,n.jsx)(r.a,{href:"https://datatracker.ietf.org/doc/draft-ietf-ppm-dap/",children:"Distributed Aggregation Protocol"}),", not just Divvi Up's aggregator."]}),"\n",(0,n.jsx)(r.admonition,{type:"note",children:(0,n.jsx)(r.p,{children:"This feature was implemented August 14, 2025. Tasks created before will start\ncounting after then, rather than for the lifetime of the task."})}),"\n",(0,n.jsx)(r.h3,{id:"successful-report-preparations",children:"Successful Report Preparations"}),"\n",(0,n.jsx)(r.p,{children:"Indicates reports successfully prepared by the aggregators. Reports contributing\nto this count are eligible for collection."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"aggregation_job_counter_success"})," in the Divvi Up API."]}),"\n",(0,n.jsx)(r.h3,{id:"aggregation-errors",children:"Aggregation Errors"}),"\n",(0,n.jsx)(r.p,{children:"Aggregators count some DAP-level errors that lead to report rejection. Rejected\nreports are not processed any further."}),"\n",(0,n.jsx)(r.p,{children:"See sections below for a description and basic troubleshooting steps for each\nerror type."}),"\n",(0,n.jsx)(r.h4,{id:"batch-collected-helper-failure",children:"Batch Collected (Helper) Failure"}),"\n",(0,n.jsx)(r.p,{children:"Indicates there were reports rejected by the helper because they had timestamps\ncorresponding to time intervals that were already collected. This is only\napplicable for tasks with a query type of time interval."}),"\n",(0,n.jsx)(r.p,{children:"Seeing this error originating in the helper is very unusual, since the leader is\nalso responsible for rejecting reports that fall into collected batches and\nshould not be including them in aggregation jobs to begin with. Thus this error\nindicates a misconfiguration or perhaps implementation error in either or both\naggregators."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"aggregation_job_counter_helper_batch_collected"})," in the\nDivvi Up API."]}),"\n",(0,n.jsx)(r.h4,{id:"report-replayed-helper-failure",children:"Report Replayed (Helper) Failure"}),"\n",(0,n.jsx)(r.p,{children:"Indicates that there were reports rejected by the helper because their report ID\nhad already been aggregated. This could indicate misconfiguration in the clients\ncontributing to the task or an unsuccessful attempt to skew aggregations."}),"\n",(0,n.jsx)(r.p,{children:"You may wish to contact the helper operator for further troubleshooting."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"aggregation_job_counter_helper_report_replayed"})," in the\nDivvi Up API."]}),"\n",(0,n.jsx)(r.h4,{id:"report-dropped-helper-failure",children:"Report Dropped (Helper) Failure"}),"\n",(0,n.jsx)(r.p,{children:"Indicates that the helper rejected a report because the leader removed it from\nan aggregation job. Check on errors reported from the task's leader."}),"\n",(0,n.jsx)(r.p,{children:"This error can only occur when using VDAFs that require multiple rounds of\npreparation, which is not the case for the Prio3 family of VDAFs."}),"\n",(0,n.jsx)(r.p,{children:"You may wish to contact the helper operator for further troubleshooting."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"aggregation_job_counter_helper_report_dropped"})," in the Divvi\nUp API."]}),"\n",(0,n.jsx)(r.h4,{id:"unknown-hpke-config-id-helper-failure",children:"Unknown HPKE Config ID (Helper) Failure"}),"\n",(0,n.jsx)(r.p,{children:"Indicates that reports were rejected because they were encrypted with an HPKE\nconfiguration that the helper does not recognize, making them impossible to\ndecrypt."}),"\n",(0,n.jsx)(r.p,{children:"This indicates that the leader was able to decrypt its report share during\nupload, but the helper failed during preparation. This suggests a configuration\nproblem with the helper's advertised HPKE configurations or with the task's\nclients."}),"\n",(0,n.jsx)(r.p,{children:"You may wish to contact the helper operator for further troubleshooting."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"aggregation_job_counter_helper_hpke_unknown_config_id"})," in\nthe Divvi Up API."]}),"\n",(0,n.jsx)(r.h4,{id:"hpke-decryption-helper-failure",children:"HPKE Decryption (Helper) Failure"}),"\n",(0,n.jsx)(r.p,{children:"Indicates that reports were rejected because the helper was unable to decrypt\nthem."}),"\n",(0,n.jsx)(r.p,{children:"This indicates that the leader was able to decrypt its report share during\nupload, but the helper failed during preparation. This suggests a configuration\nproblem with the helper's advertised HPKE configurations or with the task's\nclients. It could also indicate a problem with the HPKE implementations in the\nclients or the helper."}),"\n",(0,n.jsx)(r.p,{children:"You may wish to contact the helper operator for further troubleshooting."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"aggregation_job_counter_helper_hpke_decrypt_failure"})," in the\nDivvi Up API."]}),"\n",(0,n.jsx)(r.h4,{id:"vdaf-preparation-helper-failure",children:"VDAF Preparation (Helper) Failure"}),"\n",(0,n.jsxs)(r.p,{children:["Indicates that reports were rejected by the helper because VDAF preparation\nfailed. This could be caused by malicious clients trying to inject invalid\nreports or a task configuration problem. Make sure that the client implements\nthe right version of ",(0,n.jsx)(r.a,{href:"https://datatracker.ietf.org/doc/draft-ietf-ppm-dap/",children:"DAP"})," and that the correct task parameters are in use."]}),"\n",(0,n.jsx)(r.p,{children:"You may wish to contact the helper operator for further troubleshooting."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"aggregation_job_counter_helper_vdaf_prep_error"})," in the\nDivvi Up API."]}),"\n",(0,n.jsx)(r.h4,{id:"task-expiration-helper-failure",children:"Task Expiration (Helper) Failure"}),"\n",(0,n.jsx)(r.p,{children:"Indicates there were reports rejected by the helper because they were sent to\nthis task after it had expired."}),"\n",(0,n.jsx)(r.p,{children:"Use this metric to monitor clients migrating off of the expired task."}),"\n",(0,n.jsx)(r.p,{children:"You may wish to contact the helper operator for further troubleshooting."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"aggregation_job_counter_helper_task_expired"})," in the Divvi\nUp API."]}),"\n",(0,n.jsx)(r.h4,{id:"invalid-message-helper-failure",children:"Invalid Message (Helper) Failure"}),"\n",(0,n.jsx)(r.p,{children:"Indicates that the helper rejected reports because of incorrectly constructed or\nencoded messages."}),"\n",(0,n.jsxs)(r.p,{children:["This can be caused by configuration problems in the client. Make sure that the\nclient implements the right version of ",(0,n.jsx)(r.a,{href:"https://datatracker.ietf.org/doc/draft-ietf-ppm-dap/",children:"DAP"})," and that the correct task\nparameters are in use."]}),"\n",(0,n.jsx)(r.p,{children:"You may wish to contact the helper operator for further troubleshooting."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"aggregation_job_counter_helper_invalid_message"})," in the\nDivvi Up API."]}),"\n",(0,n.jsx)(r.h4,{id:"report-too-early-helper-failure",children:"Report Too Early (Helper) Failure"}),"\n",(0,n.jsx)(r.p,{children:"Indicates that there were reports rejected by the helper because their timestamp\nwas too far in the future."}),"\n",(0,n.jsx)(r.p,{children:"Depending on how the client derives the report timestamp, it may not be possible\nto fully eliminate this error."}),"\n",(0,n.jsx)(r.p,{children:"You may wish to contact the helper operator for further troubleshooting."}),"\n",(0,n.jsxs)(r.p,{children:["Also referred to as ",(0,n.jsx)(r.code,{children:"aggregation_job_counter_helper_report_too_early"})," in the\nDivvi Up API."]}),"\n",(0,n.jsx)(r.h2,{id:"api-access",children:"API Access"}),"\n",(0,n.jsxs)(r.p,{children:["Use ",(0,n.jsx)(r.code,{children:"GET /tasks/{task_id}"})," to retrieve upload metrics from the API. You can also\nuse the ",(0,n.jsx)(r.code,{children:"divviup"})," CLI to get a task's metrics, among other information about a\ntask:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sh",children:"divviup --token <AUTH_TOKEN> \\\n  --account-id <ACCOUNT_ID> \\\n  task get <TASK_ID>\n"})})]})}function d(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},8453:(e,r,t)=>{t.d(r,{R:()=>s,x:()=>a});var i=t(6540);const n={},o=i.createContext(n);function s(e){const r=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),i.createElement(o.Provider,{value:r},e.children)}}}]);